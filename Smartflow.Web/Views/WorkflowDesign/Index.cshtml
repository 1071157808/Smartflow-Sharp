@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Smartflow 工作流程设计器</title>
    <link href="~/Content/smartflow.css" rel="stylesheet" />
    <script src="~/Content/jquery.min.js"></script>
    <script src="~/Content/svg.js"></script>
    <script src="~/Content/layer/layer.js"></script>
    <script src="~/Content/smartflow.js"></script>
    <script type="text/javascript">
        function saveflow() {
            var exportObj = SMF.exportToJSON();
            if (exportObj) {
                var flowName = window.prompt("请输入流程名称");
                if (flowName && flowName.length > 0) {
                    $.ajax({
                        url: '@Url.Action("Save", "WorkflowDesign")',
                        data: { NAME: flowName, XML: exportObj.XML, IMAGE: exportObj.IMAGE, WFID: '@ViewBag.WfID' },
                        type: 'POST',
                        success: function () {
                            alert("操作成功");
                        }
                    });
                } else {
                    alert("请输入流程名称");
                }
            }
        }
        $(function () {
            window.SMF.bind('drawing');
            var WFID = '@ViewBag.WfID';
            if (WFID) {
                $.ajax({
                    url: '@Url.Action("GetWorkflowXml", "WorkflowDesign")',
                    type: 'post',
                    dataType: 'json',
                    data: { WFID: WFID },
                    success: function (serverData) {
                        SMF.revert(serverData.IMAGE);
                    }
                })
            } else {
                SMF.create('start');
                SMF.create('end');
            }
        });
    </script>

    <script type="text/javascript">
        function openLayerWin() {

            //tab层
            layer.tab({
                area: ['600px', '300px'],
                tab: [{
                    title: '基本信息',
                    content: '内容1'
                }, {
                    title: 'TAB2',
                    content: '内容2'
                }, {
                    title: 'TAB3',
                    content: '内容3'
                }]
            });

        }
    </script>

</head>
<body>
    <div class="tools">
        <ul class="tools-menu">
            <li>
                <a href="#" onclick="saveflow()">保存</a>
            </li>
            <li>
                <a href="#" onclick="SMF.select()">选择</a>
            </li>
            <li>
                <a href="#" onclick="SMF.connect()">连接</a>
            </li>
            <li>
                <a href="#" onclick="SMF.create('node')">节点</a>
            </li>
            <li>
                <a href="#" onclick="SMF.create('decision')">决策</a>
            </li>
        </ul>
    </div>
    <div class="container">
        <div class="container-draw" id="drawing"></div>
    </div>
 
</body>
</html>
